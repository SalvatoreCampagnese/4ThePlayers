{"version":3,"sources":["webpack:///src/app/users/users-routing.module.ts","webpack:///src/app/users/users.page.scss","webpack:///src/app/users/users.page.html","webpack:///src/app/users/users.page.ts","webpack:///src/app/users/users.module.ts"],"names":["routes","path","component","UsersPageRoutingModule","imports","forChild","exports","Storage","UsersPage","activatedRoute","env","http","authService","router","userSearch","usersList","usersFoundCounter","showButtonInvite","searchValue","queryParams","subscribe","params","teamId","tournamentId","getToken","then","isLoggedIn","get","key","data","token","value","navigateByUrl","idUser","isLoading","dataToPost","userId","post","baseUri","resp","window","alert","location","reload","error","errors","msg","response","sort","a","b","username","replace","teamObj","updateList","Object","keys","length","i","members","j","disabled","_id","invites","selector","template","UsersPageModule","declarations"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA,UAAMA,MAAM,GAAW,CACrB;AACEC,YAAI,EAAE,EADR;AAEEC,iBAAS,EAAE;AAFb,OADqB,CAAvB;;UAWaC,sBAAsB;AAAA;AAAA,O;;AAAtBA,4BAAsB,6DAJlC,+DAAS;AACRC,eAAO,EAAE,CAAC,6DAAaC,QAAb,CAAsBL,MAAtB,CAAD,CADD;AAERM,eAAO,EAAE,CAAC,4DAAD;AAFD,OAAT,CAIkC,GAAtBH,sBAAsB,CAAtB;;;;;;;;;;;;;;;;AChBb;AAAe;;;AAAA;;;;;;;;;;;;;;;;ACAf;AAAe;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCKPI,O,GAAY,uD,CAAZA,O;;UASKC,SAAS;AACpB,2BACUC,cADV,EAEUC,GAFV,EAGUC,IAHV,EAIUC,WAJV,EAKUC,MALV,EAKwB;AAAA;;AAJd,eAAAJ,cAAA,GAAAA,cAAA;AACA,eAAAC,GAAA,GAAAA,GAAA;AACA,eAAAC,IAAA,GAAAA,IAAA;AACA,eAAAC,WAAA,GAAAA,WAAA;AACA,eAAAC,MAAA,GAAAA,MAAA;AAEV,eAAAC,UAAA,GAAqB,IAArB;AAIA,eAAAC,SAAA,GAAiB,EAAjB;AACA,eAAAC,iBAAA,GAA4B,CAA5B;AAEA,eAAAC,gBAAA,GAA4B,IAA5B;AACA,eAAAC,WAAA,GAAsB,IAAtB;AATK;;AAPe;AAAA;AAAA,qCAkBT;AAAA;;AACT,iBAAKT,cAAL,CAAoBU,WAApB,CAAgCC,SAAhC,CAA0C,UAACC,MAAD,EAAY;AACpD,kBAAMC,MAAM,GAAGD,MAAM,CAAC,QAAD,CAArB;AACA,kBAAME,YAAY,GAAGF,MAAM,CAAC,cAAD,CAA3B;;AACA,kBAAI,CAACC,MAAD,IAAW,CAACC,YAAhB,EAA8B;AAC5B,qBAAI,CAACN,gBAAL,GAAwB,KAAxB;AACD,eAFD,MAEO;AACL,qBAAI,CAACK,MAAL,GAAcA,MAAd;AAEA,qBAAI,CAACC,YAAL,GAAoBA,YAApB;AACD;;AACD,mBAAI,CAACX,WAAL,CAAiBY,QAAjB,GAA4BC,IAA5B,CAAiC,YAAM;AACrC,oBAAI,KAAI,CAACb,WAAL,CAAiBc,UAArB,EAAiC;AAC/BnB,yBAAO,CAACoB,GAAR,CAAY;AAAEC,uBAAG,EAAE;AAAP,mBAAZ,EAA8BH,IAA9B,CAAmC,UAACI,IAAD,EAAU;AAC3C,yBAAI,CAACC,KAAL,GAAaD,IAAI,CAACE,KAAlB;AACD,mBAFD;AAGD,iBAJD,MAIO;AACL,uBAAI,CAAClB,MAAL,CAAYmB,aAAZ,CAA0B,QAA1B;AACD;AACF,eARD;AASD,aAnBD;AAoBD;AAvCmB;AAAA;AAAA,uCAyCPC,MAzCO,EAyCC;AAAA;;AACnB,iBAAKvB,GAAL,CAASwB,SAAT,GAAqB,IAArB;AACA,gBAAMC,UAAU,GAAG;AACjBC,oBAAM,EAAEH;AADS,aAAnB,CAFmB,CAKnB;;AACA,gBAAIA,MAAM,IAAI,KAAKX,MAAnB,EAA2B;AACzB;AACA,mBAAKX,IAAL,CACG0B,IADH,CAEI,KAAK3B,GAAL,CAAS4B,OAAT,0BACgB,KAAKf,YADrB,oBAC2C,KAAKD,MADhD,aAFJ,EAIIa,UAJJ,EAMGf,SANH,CAOI,UAACmB,IAAD,EAAU;AACR,sBAAI,CAAC7B,GAAL,CAASwB,SAAT,GAAqB,KAArB;AACAM,sBAAM,CAACC,KAAP,CAAa,wBAAb;AACAC,wBAAQ,CAACC,MAAT;AACD,eAXL,EAYI,UAACC,KAAD,EAAW;AACT,sBAAI,CAAClC,GAAL,CAASwB,SAAT,GAAqB,KAArB;AACAM,sBAAM,CAACC,KAAP,CAAaG,KAAK,CAACA,KAAN,CAAYC,MAAZ,CAAmB,CAAnB,EAAsBC,GAAnC;AACAJ,wBAAQ,CAACC,MAAT;AACD,eAhBL;AAkBD,aApBD,MAoBO;AACL;AACD;AACF;AAtEmB;AAAA;AAAA,uCAwEP;AAAA;;AACX;AACA,gBAAI,KAAK7B,UAAT,EAAqB;AACnB,mBAAKH,IAAL,CACGgB,GADH,WACU,KAAKjB,GAAL,CAAS4B,OADnB,6BAC6C,KAAKxB,UADlD,GAEGM,SAFH,CAEa,UAAC2B,QAAD,EAAc;AACvB,sBAAI,CAAChC,SAAL,GAAiBgC,QAAjB;;AACA,sBAAI,CAAChC,SAAL,CAAeiC,IAAf,CAAoB,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAClC,yBAAOD,CAAC,CAACE,QAAF,CAAWC,OAAX,CAAmB,GAAnB,EAAwB,EAAxB,IAA8BF,CAAC,CAACC,QAAF,CAAWC,OAAX,CAAmB,GAAnB,EAAwB,EAAxB,CAA9B,GACH,CADG,GAEH,CAAC,CAFL;AAGD,iBAJD;;AAKA,oBAAI,MAAI,CAAC9B,MAAT,EAAiB;AACf,wBAAI,CAACX,IAAL,CACGgB,GADH,CAEI,MAAI,CAACjB,GAAL,CAAS4B,OAAT,0BACgB,MAAI,CAACf,YADrB,oBAC2C,MAAI,CAACD,MADhD,CAFJ,EAKGF,SALH,CAKa,UAACmB,IAAD,EAAU;AACnB,0BAAI,CAACc,OAAL,GAAed,IAAf;;AACA,0BAAI,CAACe,UAAL;;AACA,0BAAI,CAACtC,iBAAL,GAAyBuC,MAAM,CAACC,IAAP,CAAY,MAAI,CAACzC,SAAjB,EAA4B0C,MAArD;AACD,mBATH;AAUD;AACF,eArBH;AAsBD,aAvBD,MAuBO;AACL,mBAAKzC,iBAAL,GAAyB,CAAzB;AACA,mBAAKD,SAAL,GAAiB,EAAjB;AACD;AACF;AArGmB;AAAA;AAAA,uCAsGP;AACX,gBAAI,KAAKA,SAAL,IAAkB,KAAKsC,OAA3B,EAAoC;AAClC,mBAAK,IAAIK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKL,OAAL,CAAaM,OAAb,CAAqBF,MAAzC,EAAiDC,CAAC,EAAlD,EAAsD;AACpD,qBAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK7C,SAAL,CAAe0C,MAAnC,EAA2CG,CAAC,EAA5C,EAAgD;AAC9C,uBAAK7C,SAAL,CAAe6C,CAAf,EAAkBC,QAAlB,GAA6B,KAAK9C,SAAL,CAAe6C,CAAf,EAAkBC,QAAlB,GACzB,IADyB,GAEzB,KAFJ;;AAGA,sBAAI,KAAKR,OAAL,CAAaM,OAAb,CAAqBD,CAArB,EAAwBtB,MAAxB,KAAmC,KAAKrB,SAAL,CAAe6C,CAAf,EAAkBE,GAAzD,EAA8D;AAC5D,yBAAK/C,SAAL,CAAe6C,CAAf,EAAkBC,QAAlB,GAA6B,IAA7B;AACD;AACF;AACF;;AACD,mBAAK,IAAIH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKL,OAAL,CAAaU,OAAb,CAAqBN,MAAzC,EAAiDC,CAAC,EAAlD,EAAsD;AACpD,qBAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK7C,SAAL,CAAe0C,MAAnC,EAA2CG,CAAC,EAA5C,EAAgD;AAC9C,uBAAK7C,SAAL,CAAe6C,CAAf,EAAkBC,QAAlB,GAA6B,KAAK9C,SAAL,CAAe6C,CAAf,EAAkBC,QAAlB,GACzB,IADyB,GAEzB,KAFJ;;AAGA,sBAAI,KAAKR,OAAL,CAAaU,OAAb,CAAqBL,CAArB,EAAwBtB,MAAxB,KAAmC,KAAKrB,SAAL,CAAe6C,CAAf,EAAkBE,GAAzD,EAA8D;AAC5D,yBAAK/C,SAAL,CAAe6C,CAAf,EAAkBC,QAAlB,GAA6B,IAA7B;AACD;AACF;AACF;AACF;AACF;AA7HmB;;AAAA;AAAA,S;;;;gBAZb;;gBAEA;;gBAJA;;gBAMA;;gBACA;;;;AAOIrD,eAAS,6DALrB,gEAAU;AACTwD,gBAAQ,EAAE,WADD;AAETC,gBAAQ,EAAR,mEAFS;;AAAA,OAAV,CAKqB,GAATzD,SAAS,CAAT;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;UCKA0D,eAAe;AAAA;AAAA,O;;AAAfA,qBAAe,6DAT3B,+DAAS;AACR9D,eAAO,EAAE,CACP,4DADO,EAEP,0DAFO,EAGP,0DAHO,EAIP,4EAJO,CADD;AAOR+D,oBAAY,EAAE,CAAC,qDAAD;AAPN,OAAT,CAS2B,GAAfD,eAAe,CAAf","file":"users-users-module-es5.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { UsersPage } from './users.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: UsersPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class UsersPageRoutingModule {}\r\n","export default \"ion-row {\\n  border-bottom: 1px solid rgba(255, 255, 255, 0.5);\\n}\\nion-row ion-col {\\n  display: flex;\\n  align-items: center;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvdXNlcnMvdXNlcnMucGFnZS5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0ksaURBQUE7QUFDSjtBQUNJO0VBQ0ksYUFBQTtFQUNBLG1CQUFBO0FBQ1IiLCJmaWxlIjoic3JjL2FwcC91c2Vycy91c2Vycy5wYWdlLnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyJpb24tcm93e1xyXG4gICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkIHJnYmEoMjU1LDI1NSwyNTUsMC41KTtcclxuXHJcbiAgICBpb24tY29se1xyXG4gICAgICAgIGRpc3BsYXk6IGZsZXg7XHJcbiAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcclxuICAgIH1cclxufSJdfQ== */\";","export default \"<ion-header>\\r\\n  <ion-toolbar>\\r\\n    <ion-buttons slot=\\\"start\\\">\\r\\n      <ion-back-button></ion-back-button>\\r\\n    </ion-buttons>\\r\\n    <ion-title>Utenti</ion-title>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content style=\\\"--padding: 5px !important\\\" [fullscreen]=\\\"true\\\">\\r\\n  <ion-item color=\\\"white\\\">\\r\\n    <ion-label><i class=\\\"fas fa-search\\\"></i></ion-label>\\r\\n    <ion-input placeholder=\\\"Ricerca...\\\" [(ngModel)]=\\\"userSearch\\\"></ion-input>\\r\\n    <ion-button (click)=\\\"searchUser()\\\">Ricerca</ion-button>\\r\\n  </ion-item>\\r\\n  <br />\\r\\n  <ion-text>\\r\\n    <h2>Lista utenti</h2>\\r\\n  </ion-text>\\r\\n  <ion-grid style=\\\"padding: 5px\\\">\\r\\n    <ion-text *ngIf=\\\"usersFoundCounter == 0 && !userSearch\\\"\\r\\n      >Effettua una ricerca...</ion-text\\r\\n    >\\r\\n    <ion-text *ngIf=\\\"usersFoundCounter == 0 && userSearch\\\"\\r\\n      >Nessun utente trovato...</ion-text\\r\\n    >\\r\\n    <ion-row *ngFor=\\\"let user of usersList\\\">\\r\\n      <ion-col size=\\\"10\\\">{{user.username}}</ion-col>\\r\\n      <ion-col *ngIf=\\\"showButtonInvite\\\" size=\\\"2\\\">\\r\\n        <ion-button\\r\\n          disabled=\\\"{{user.disabled}}\\\"\\r\\n          (click)=\\\"onInviteUser(user._id)\\\"\\r\\n          ><i class=\\\"fas fa-plus\\\"></i\\r\\n        ></ion-button>\\r\\n      </ion-col>\\r\\n    </ion-row>\\r\\n  </ion-grid>\\r\\n</ion-content>\\r\\n\";","import { HttpClient, HttpHeaders, HttpParams } from \"@angular/common/http\";\r\nimport { Component, OnInit } from \"@angular/core\";\r\nimport { ActivatedRoute } from \"@angular/router\";\r\nimport { Plugins } from \"@capacitor/core\";\r\nimport { GlobalEnv } from \"../env\";\r\nconst { Storage } = Plugins;\r\nimport { AuthService } from \"src/app/services/auth.service\";\r\nimport { Router } from \"@angular/router\";\r\n\r\n@Component({\r\n  selector: \"app-users\",\r\n  templateUrl: \"./users.page.html\",\r\n  styleUrls: [\"./users.page.scss\"],\r\n})\r\nexport class UsersPage implements OnInit {\r\n  constructor(\r\n    private activatedRoute: ActivatedRoute,\r\n    private env: GlobalEnv,\r\n    private http: HttpClient,\r\n    private authService: AuthService,\r\n    private router: Router\r\n  ) { }\r\n  userSearch: string = null;\r\n  teamId: any;\r\n  teamObj: any;\r\n  token: string;\r\n  usersList: any = [];\r\n  usersFoundCounter: number = 0;\r\n  tournamentId: any;\r\n  showButtonInvite: boolean = true;\r\n  searchValue: string = null;\r\n\r\n  ngOnInit() {\r\n    this.activatedRoute.queryParams.subscribe((params) => {\r\n      const teamId = params[\"teamId\"];\r\n      const tournamentId = params[\"tournamentId\"];\r\n      if (!teamId || !tournamentId) {\r\n        this.showButtonInvite = false;\r\n      } else {\r\n        this.teamId = teamId;\r\n\r\n        this.tournamentId = tournamentId;\r\n      }\r\n      this.authService.getToken().then(() => {\r\n        if (this.authService.isLoggedIn) {\r\n          Storage.get({ key: \"token\" }).then((data) => {\r\n            this.token = data.value;\r\n          });\r\n        } else {\r\n          this.router.navigateByUrl(\"/login\");\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  onInviteUser(idUser) {\r\n    this.env.isLoading = true;\r\n    const dataToPost = {\r\n      userId: idUser,\r\n    };\r\n    // Se ho tutti i dati a disposizione continuo con gli inviti\r\n    if (idUser && this.teamId) {\r\n      // Completo l'invito\r\n      this.http\r\n        .post(\r\n          this.env.baseUri +\r\n          `/tournaments/${this.tournamentId}/teams/${this.teamId}/invites`,\r\n          dataToPost\r\n        )\r\n        .subscribe(\r\n          (resp) => {\r\n            this.env.isLoading = false;\r\n            window.alert(\"Invitato correttamente\");\r\n            location.reload();\r\n          },\r\n          (error) => {\r\n            this.env.isLoading = false;\r\n            window.alert(error.error.errors[0].msg);\r\n            location.reload();\r\n          }\r\n        );\r\n    } else {\r\n      return;\r\n    }\r\n  }\r\n\r\n  searchUser() {\r\n    //\r\n    if (this.userSearch) {\r\n      this.http\r\n        .get(`${this.env.baseUri}/users?username=${this.userSearch}`)\r\n        .subscribe((response) => {\r\n          this.usersList = response;\r\n          this.usersList.sort(function (a, b) {\r\n            return a.username.replace(\" \", \"\") > b.username.replace(\" \", \"\")\r\n              ? 1\r\n              : -1;\r\n          });\r\n          if (this.teamId) {\r\n            this.http\r\n              .get(\r\n                this.env.baseUri +\r\n                `/tournaments/${this.tournamentId}/teams/${this.teamId}`\r\n              )\r\n              .subscribe((resp) => {\r\n                this.teamObj = resp;\r\n                this.updateList();\r\n                this.usersFoundCounter = Object.keys(this.usersList).length;\r\n              });\r\n          }\r\n        });\r\n    } else {\r\n      this.usersFoundCounter = 0;\r\n      this.usersList = [];\r\n    }\r\n  }\r\n  updateList() {\r\n    if (this.usersList && this.teamObj) {\r\n      for (var i = 0; i < this.teamObj.members.length; i++) {\r\n        for (var j = 0; j < this.usersList.length; j++) {\r\n          this.usersList[j].disabled = this.usersList[j].disabled\r\n            ? true\r\n            : false;\r\n          if (this.teamObj.members[i].userId === this.usersList[j]._id) {\r\n            this.usersList[j].disabled = true;\r\n          }\r\n        }\r\n      }\r\n      for (var i = 0; i < this.teamObj.invites.length; i++) {\r\n        for (var j = 0; j < this.usersList.length; j++) {\r\n          this.usersList[j].disabled = this.usersList[j].disabled\r\n            ? true\r\n            : false;\r\n          if (this.teamObj.invites[i].userId === this.usersList[j]._id) {\r\n            this.usersList[j].disabled = true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { UsersPageRoutingModule } from './users-routing.module';\r\n\r\nimport { UsersPage } from './users.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    UsersPageRoutingModule\r\n  ],\r\n  declarations: [UsersPage]\r\n})\r\nexport class UsersPageModule {}\r\n"]}