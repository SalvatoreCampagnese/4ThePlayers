<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
      <ion-badge
        color="danger"
        class="badge-notifiche"
        *ngIf="this.env.notificationsCounter"
      >
        {{this.env.notificationsCounter}}</ion-badge
      >
    </ion-buttons>
    <ion-title>Torneo</ion-title>
    <ion-buttons style="padding-right: 20px" slot="end">
      <ion-text>{{this.userCoins}}</ion-text>&nbsp;&nbsp;<i
        class="fas fa-coins"
        color="orange"
      ></i>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" style="overflow-y: scroll !important">
  <ion-refresher slot="fixed" (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <div id="container flex-direction-column" style="margin-bottom: 10px">
    <!-- Mostro se deve creare il team -->
    <ion-text *ngIf="showSubscribeBox == true && isOpen == true"
      >Non sei ancora iscritto alla competizione.</ion-text
    >
    <ion-button
      (click)="showCreateTeamModal()"
      *ngIf="showSubscribeBox == true && isOpen == true"
      >Crea un Team</ion-button
    >
    <ion-text
      *ngIf="isOpen == false && showSubscribeBox == true"
      style="margin-top: 10px"
      >Iscrizioni alla competizione chiuse.</ion-text
    >

    <!-- Mostro se non rispecchia il nr di membri corretto -->
    <ion-text *ngIf="showErrorTeam == true" style="padding: 15px"
      >Non hai un nr. adeguato di membri per pubblicare una sfida.</ion-text
    ><br />
    <ion-button (click)="showInviteMembers()" *ngIf="showErrorTeam == true"
      >Invita Membri</ion-button
    >

    <!-- Mostro se Ã¨ ok -->
    <ion-text *ngIf="showCreateMatch == true">Gioca ora!</ion-text><br />
    <ion-button (click)="showCreateMatchFn()" *ngIf="showCreateMatch == true"
      >Crea un Match</ion-button
    ><br />
    <ion-button (click)="showInviteMembers()" *ngIf="showCreateMatch == true"
      ><i class="fas fa-plus"></i>&nbsp;Invita Membri</ion-button
    >

    <div *ngIf="showMatchPending === true">
      <ion-text>Match in Corso!</ion-text> <br />
      <div *ngIf="alreadyMatched==true">
        <ion-card>
          <ion-grid>
            <ion-row style="width: 100%">
              <ion-col size="5" class="ion-text-center centered"
                ><div class="avatar avatar1"></div>
                {{this.matchPending.teamOne.name}}</ion-col
              >
              <ion-col size="2" class="ion-text-center"> vs </ion-col>
              <ion-col size="5" class="ion-text-center centered"
                ><div class="avatar avatar1"></div>
                {{this.matchPending.teamTwo.name}}</ion-col
              >
              <ion-col
                size="12"
                class="ion-text-center"
                style="font-size: 0.8em; font-style: italic"
                >{{this.matchPending.createdAt}}</ion-col
              >
              <ion-col
                size="12"
                class="ion-text-center"
                style="font-size: 0.8em; font-style: italic"
                >Regolamento: {{this.matchPending.rulesetName}}</ion-col
              >
              <ion-col
                *ngFor="let item of [].constructor(matchPending.maps.length); let i = index"
                size="4"
                class="ion-text-center"
                style="font-size: 0.8em; font-weight: bold"
                >Mappa {{i + 1}}</ion-col
              >
              <ion-col
                *ngFor="let map of matchPending.maps"
                size="4"
                class="ion-text-center"
                style="font-size: 0.8em; font-style: italic"
                >{{map}}</ion-col
              >
              <ion-col
                size="12"
                class="ion-text-center"
                style="font-size: 0.8em; font-style: italic"
              >
                <ion-button
                  (click)="changeResultMatch(this.matchPending, 'WIN')"
                  >Vinto</ion-button
                >
                <ion-button
                  (click)="changeResultMatch(this.matchPending, 'LOSS')"
                  color="danger"
                  >Perso
                </ion-button>
              </ion-col>
            </ion-row>
          </ion-grid>
        </ion-card>
      </div>
      <div *ngIf="alreadyMatched==false">
        <ion-text>Ricerca match in corso...</ion-text><br />
        <ion-button (click)="deleteMatch(this.matchPending)" color="danger"
          >Cancella
        </ion-button>
      </div>
    </div>
  </div>

  <ion-segment (ionChange)="onTabChange($event)" value="classifica">
    <ion-segment-button value="classifica">
      <ion-label color="white">Classifica</ion-label>
    </ion-segment-button>
    <ion-segment-button value="regolamento">
      <ion-label color="white">Regole</ion-label>
    </ion-segment-button>
    <ion-segment-button value="matches">
      <ion-label color="white">Match</ion-label>
    </ion-segment-button>
    <ion-segment-button value="sponsor">
      <ion-label color="white">Sponsor</ion-label>
    </ion-segment-button>
  </ion-segment>
  <div
    id="classifica"
    *ngIf="showClassifica"
    style="overflow-y: scroll !important; height: 100%; margin-top: 15px"
  >
    <ion-grid>
      <ion-row class="header">
        <ion-col size="1.4">#</ion-col>
        <ion-col size="5.6">Nome team</ion-col>
        <ion-col size="2">PT</ion-col>
        <ion-col size="1">W</ion-col>
        <ion-col size="1">D</ion-col>
        <ion-col size="1">L</ion-col>
      </ion-row>
      <ion-row
        class="fair"
        *ngFor="let team of teamsList, let i = index"
        (click)="showTeamsInfo(team._id)"
      >
        <ion-col size="1.4">{{i + 1}}</ion-col>
        <ion-col size="5.6">{{team.name}}</ion-col>
        <ion-col size="2">{{team.elo}}</ion-col>
        <ion-col size="1">{{team.wins}}</ion-col>
        <ion-col size="1">{{team.ties}}</ion-col>
        <ion-col size="1">{{team.losses}}</ion-col>
      </ion-row>
    </ion-grid>
  </div>
  <div
    id="regolamento"
    *ngIf="showRegolamento"
    style="overflow-y: scroll !important; margin-top: 15px"
  >
    Regolamento & Settaggi<br />{{this.tournamentDetail.ruleset.description}}
  </div>
  <div
    id="matches"
    *ngIf="showMatches"
    style="overflow-y: scroll !important; margin-top: 15px"
  >
    <div *ngIf="counterMatchPending != 0">
      <ion-text>Match in corso: {{counterMatchPending}}</ion-text>
      <ion-grid>
        <ion-row *ngFor="let match of matchesList" class="border-bottom">
          <ion-row
            *ngIf="match.status == 'PENDING' && match.teamOne && match.teamTwo"
            style="width: 100%"
          >
            <ion-col
              size="5"
              class="ion-text-center centered"
              *ngIf="match.teamOne && match.teamTwo"
              ><div class="avatar avatar1"></div>
              {{match.teamOne.name}}</ion-col
            >
            <ion-col size="2" class="ion-text-center"> vs </ion-col>
            <ion-col
              size="5"
              class="ion-text-center centered"
              *ngIf="match.teamOne && match.teamTwo"
              ><div class="avatar avatar1"></div>
              {{match.teamTwo.name}}</ion-col
            >
            <ion-col
              size="12"
              class="ion-text-center"
              style="font-size: 0.8em; font-style: italic"
              >{{match.acceptedAt}}</ion-col
            >
          </ion-row>
        </ion-row>
      </ion-grid>
    </div>
    <div *ngIf="counterMatchClosed != 0" style="margin-top: 15px">
      <ion-text>Match conclusi: {{counterMatchClosed}}</ion-text>
      <ion-grid>
        <ion-row *ngFor="let match of matchesList" class="border-bottom">
          <ion-row
            style="width: 100%"
            *ngIf="match.status=='TEAM1' || match.status=='TEAM2'"
          >
            <ion-col
              size="5"
              class="ion-text-center winner centered"
              *ngIf="match.status == 'TEAM1'"
              ><div class="avatar avatar1"></div>
              {{match.teamOne.name}}</ion-col
            >
            <ion-col
              size="5"
              class="ion-text-center looser centered"
              *ngIf="match.status != 'TEAM1'"
              ><div class="avatar avatar1"></div>
              {{match.teamOne.name}}</ion-col
            >
            <ion-col size="2" class="ion-text-center"> vs </ion-col>
            <ion-col
              size="5"
              class="ion-text-center winner centered"
              *ngIf="match.status == 'TEAM2'"
              ><div class="avatar avatar1"></div>
              {{match.teamTwo.name}}</ion-col
            >
            <ion-col
              size="5"
              class="ion-text-center looser centered"
              *ngIf="match.status != 'TEAM2'"
              ><div class="avatar avatar1"></div>
              {{match.teamTwo.name}}</ion-col
            >
            <ion-col
              size="12"
              class="ion-text-center"
              style="font-size: 0.8em; font-style: italic"
              >{{match.createdAt}}</ion-col
            >
          </ion-row>
        </ion-row>
      </ion-grid>
    </div>
  </div>
  <div
    id="sponsor"
    *ngIf="showSponsor"
    style="overflow-y: scroll !important; margin-top: 15px"
  >
    <img src="../../assets/img/hydralogo.png" />
  </div>

  <div class="create-match-container" *ngIf="showModalCreateMatch">
    <div class="create-match-modal">
      <br />
      <ion-title>Crea Match</ion-title>
      <ion-grid
        *ngIf="matchesNotAccepted.length > 0"
        style="max-width: 100%"
        class="vertical-center"
      >
        <ion-row
          size="12"
          *ngFor="let matchNotAccepted of matchesNotAccepted"
          style="margin-bottom: 2px"
        >
          <ion-col size="1"
            ><i
              class="fas fa-angle-up"
              style="color: red"
              *ngIf="this.tournamentDetail.userTeam.elo <= matchNotAccepted.teamOne.elo"
            ></i
            ><i
              class="fas fa-angle-down"
              style="color: green"
              *ngIf="this.tournamentDetail.userTeam.elo > matchNotAccepted.teamOne.elo"
            ></i
          ></ion-col>
          <ion-col size="3"
            >{{matchNotAccepted.numberOfPlayers}} vs
            {{matchNotAccepted.numberOfPlayers}}</ion-col
          >
          <ion-col size="6">{{matchNotAccepted.rulesetName}}</ion-col>
          <ion-col size="2"
            ><ion-button color="success" (click)="acceptMatch(matchNotAccepted)"
              ><i class="fas fa-check"></i></ion-button
          ></ion-col>
        </ion-row>
      </ion-grid>
      <br />
      <form (submit)="createMatchFn()">
        <ion-text><i class="fas fa-align-left"></i> Regolamento</ion-text>
        <br /><br />
        <ion-text color="danger" *ngIf="showErrorRuleset"
          >Seleziona un regolamento...</ion-text
        >
        <ion-select
          [(ngModel)]="matchForm.ruleset"
          name="ruleset"
          hasError="showErrorRuleset"
          placeholder="Seleziona un regolamento..."
          interface="popover"
          required
        >
          <ion-select-option
            [value]="ruleset._id"
            *ngFor="let ruleset of tournamentDetail.ruleset"
            >{{ruleset.name}}</ion-select-option
          >
        </ion-select>
        <br /><br />
        <ion-text><i class="fas fa-users"></i> Numero players</ion-text>
        <br /><br />
        <ion-text color="danger" *ngIf="showErrorNrPlayers"
          >Seleziona un nr di players...</ion-text
        >
        <ion-select
          [(ngModel)]="matchForm.nrPlayers"
          name="nrPlayers"
          hasError="showErrorNrPlayers"
          interface="popover"
          placeholder="Seleziona il nr. di players..."
          required
        >
          <ion-select-option value="4">4vs4</ion-select-option>
          <ion-select-option value="5">5vs5</ion-select-option>
        </ion-select>
        <br />
        <ion-button color="success" type="submit">Crea Match</ion-button>
        <ion-button color="danger" (click)="closeCreateMatch()"
          >Chiudi</ion-button
        >
      </form>
    </div>
  </div>
</ion-content>
